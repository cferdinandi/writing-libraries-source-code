<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<title>Project Complete</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<!-- Styles -->
		<style type="text/css">
			body {
				margin-left: auto;
				margin-right: auto;
				max-width: 40em;
				width: 88%;
			}

			input,
			textarea {
				margin-bottom: 2em;
				width: 100%;
			}

			textarea {
				height: 12em;
			}

			/**
			 * Simple Grid
			 */

			.clearfix:before,
			.clearfix:after {
				display: table;
				content: " ";
			}

			.clearfix:after {
				clear: both;
			}

			.grid {
				box-sizing: border-box;
				float: left;
				padding: 0 3%;
				width: 50%;
			}
		</style>
	</head>

	<body>

		<h1>Type Preview</h1>

		<div class="clearfix">
			<div class="grid">
				<h2>Write Here</h2>
				<textarea class="mirror" data-mirror="#content-1"></textarea>
			</div>
			<div class="grid">
				<h2>Preview</h2>
				<div id="content-1"></div>
			</div>
		</div>

		<div class="clearfix">
			<div class="grid">
				<input type="text" class="mirror" data-mirror="#content-2">
			</div>
			<div class="grid">
				<div id="content-2"></div>
			</div>
		</div>


		<!-- Scripts -->
		<script>
			/*!
			 * Universal Module Definition (UMD) Boilerplate
			 * (c) 2017 Chris Ferdinandi, MIT License, https://gomakethings.com
			 */
			 (function (root, factory) {
			 	if ( typeof define === 'function' && define.amd ) {
			 		define([], function () {
			 			return factory(root);
			 		});
			 	} else if ( typeof exports === 'object' ) {
			 		module.exports = factory(root);
			 	} else {
			 		root.Mirror = factory(root);
			 	}
			 })(typeof global !== 'undefined' ? global : typeof window !== 'undefined' ? window : this, function (window) {

				'use strict';


				//
				// Polyfills
				//

				/**
				 * Element.matches() polyfill (simple version)
				 * https://developer.mozilla.org/en-US/docs/Web/API/Element/matches#Polyfill
				 */
				if (!Element.prototype.matches) {
					Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;
				}

				/**
				 * CustomEvent() polyfill
				 * https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent#Polyfill
				 */
				(function () {

					if (typeof window.CustomEvent === "function") return false;

					function CustomEvent(event, params) {
						params = params || { bubbles: false, cancelable: false, detail: undefined };
						var evt = document.createEvent('CustomEvent');
						evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);
						return evt;
					}

					CustomEvent.prototype = window.Event.prototype;

					window.CustomEvent = CustomEvent;
				})();


				//
				// Shared Variables
				//

				// Default settings
				var defaults = {
					content: 'data-mirror'
				};


				//
				// Shared Methods
				//

				/*!
				 * Merge two or more objects together.
				 * (c) 2017 Chris Ferdinandi, MIT License, https://gomakethings.com
				 * @param   {Boolean}  deep     If true, do a deep (or recursive) merge [optional]
				 * @param   {Object}   objects  The objects to merge together
				 * @returns {Object}            Merged values of defaults and options
				 */
				var extend = function () {

					// Variables
					var extended = {};
					var deep = false;
					var i = 0;

					// Check if a deep merge
					if ( Object.prototype.toString.call( arguments[0] ) === '[object Boolean]' ) {
					    deep = arguments[0];
					    i++;
					}

					// Merge the object into the extended object
					var merge = function (obj) {
						for (var prop in obj) {
							if (obj.hasOwnProperty(prop)) {
								// If property is an object, merge properties
								if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {
									extended[prop] = extend(extended[prop], obj[prop]);
								} else {
									extended[prop] = obj[prop];
								}
							}
						}
					};

					// Loop through each object and conduct a merge
					for (; i < arguments.length; i++) {
						var obj = arguments[i];
						merge(obj);
					}

					return extended;

				};

				//
				// Constructor
				//

				var Mirror = function (selector, options) {


					//
					// Unique Variables
					//

					// Hold our public methods
					var publicAPIs = {};

					// Default settings
					var defaults = {
						selector: '.mirror',
						content: 'data-mirror'
					};

					// Define settings variable
					var settings;


					//
					// Unique Methods
					//

					/**
					 * Copy our field content into the container
					 * @param {Node} mirror The field to mirror
					 * @param {Node} target The field to mirror content into
					 */
					publicAPIs.mirror = function (mirror, target) {
						target.innerHTML = mirror.value.replace(/\r?\n/g, '<br>');

						// Dispatch a custom event
						if (typeof window.CustomEvent === 'function') {
							var customEvent = new CustomEvent('mirrored', {
								bubbles: true,
								detail: {
									content: target
								}
							});
							mirror.dispatchEvent(customEvent);
						}
					};


					/**
					 * Handle changes to our inputs and textareas
					 */
					var changeHandler = function () {

						// Check if the keyup/paste event happened in a field we want to mirror
						var mirror = document.activeElement;
						if (!mirror.matches(settings.selector)) return;

						// Get the container to mirror our content into
						var target = document.querySelector(mirror.getAttribute(settings.content));
						if (!target) return;

						// Set a 1ms timeout to account for paste event happening before text is pasted in
						window.setTimeout(function () {
							publicAPIs.mirror(mirror, target);
						}, 1);

					};

					/**
					 * Destroy initialization
					 */
					publicAPIs.destroy = function () {

						// Only run if settings exist
						if (!settings) return;

						// Remove event listeners
						document.removeEventListener('keyup', changeHandler, false);
						document.removeEventListener('paste', changeHandler, false);

						// Reset any mirrored content
						var mirrors = document.querySelectorAll(settings.selector);
						for (var i = 0; i < mirrors.length; i++) {
							var content = document.querySelector(mirrors[i].getAttribute(settings.content));
							if (!content) continue;
							content.innerHTML = '';
						}

						// Reset settings
						settings = null;

					};

					/**
					 * Initialize the plugin
					 * @param {Object} options User options
					 */
					publicAPIs.init = function (options) {

						// Destroy any existing initialization
						publicAPIs.destroy();

						// Merge user options into defaults
						settings = extend(defaults, options || {});

						// Detect changes to our fields
						document.addEventListener('keyup', changeHandler, false);
						document.addEventListener('paste', changeHandler, false);

					};

					// Initialize the plugin
					publicAPIs.init(options);

					// Return our public methods
					return publicAPIs;

				};


				// Return our constructor
				return Mirror;

			});

			// Initialize the plugin
			var mirror = new Mirror('.mirror');

			// Listen for `mirrored` events
			document.addEventListener('mirrored', function (event) {
				console.log(event.target);
				console.log(event.detail.content);
			}, false);
		</script>
	</body>
</html>