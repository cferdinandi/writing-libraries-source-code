<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<title>Callbacks</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<!-- Styles -->
		<style type="text/css">
			body {
				max-width: 40em;
				width: 88%;
				margin-left: auto;
				margin-right: auto;
			}

			.accordion {
				display: none;
			}

			.accordion.active {
				display: block;
			}
		</style>
	</head>

	<body>

		<p><a class="accordion-toggle" href="#content-1">Show More 1</a></p>

		<div class="accordion" id="content-1">
			<p>Some content...</p>
		</div>

		<p><a class="accordion-toggle" href="#content-2">Show More 2</a></p>

		<div class="accordion" id="content-2">
			<p>Some more content...</p>
		</div>

		<p><a class="accordion-toggle" href="#content-3">Show More 3</a></p>

		<div class="accordion" id="content-3">
			<p>Even more content...</p>
		</div>


		<!-- Scripts -->
		<script>
			var accordion = (function () {

				'use strict';

				// Element.matches() polyfill (simple version)
				// https://developer.mozilla.org/en-US/docs/Web/API/Element/matches#Polyfill
				if (!Element.prototype.matches) {
					Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;
				}

				// Variables
				var publicAPIs = {}; // Our public APIs
				var settings; // Settings

				// Defaults
				var defaults = {
					// Selectors
					selectorToggle: '.accordion-toggle',
					selectorContent: '.accordion',

					// Classes
					toggleClass: 'active',
					contentClass: 'active',
					init: 'js-accordion',

					// Callbacks
					callbackClose: function () {},
					callbackOpen: function () {}
				};

				/*!
				 * Merge two or more objects together.
				 * (c) 2017 Chris Ferdinandi, MIT License, https://gomakethings.com
				 * @param   {Boolean}  deep     If true, do a deep (or recursive) merge [optional]
				 * @param   {Object}   objects  The objects to merge together
				 * @returns {Object}            Merged values of defaults and options
				 */
				var extend = function () {

					// Variables
					var extended = {};
					var deep = false;
					var i = 0;

					// Check if a deep merge
					if ( Object.prototype.toString.call( arguments[0] ) === '[object Boolean]' ) {
					    deep = arguments[0];
					    i++;
					}

					// Merge the object into the extended object
					var merge = function (obj) {
						for (var prop in obj) {
							if (obj.hasOwnProperty(prop)) {
								// If property is an object, merge properties
								if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {
									extended[prop] = extend(extended[prop], obj[prop]);
								} else {
									extended[prop] = obj[prop];
								}
							}
						}
					};

					// Loop through each object and conduct a merge
					for (; i < arguments.length; i++) {
						var obj = arguments[i];
						merge(obj);
					}

					return extended;

				};

				// Check if the target content is already active
				var isActive = function (content, toggle) {
					if (content.classList.contains(settings.contentClass)) {
						content.classList.remove(settings.contentClass);
						toggle.classList.remove(settings.toggleClass);

						// Run a callback
						settings.callbackClose(content, toggle);

						return true;

					}
				};

				// Close all items with a matching selector
				var closeItems = function (selector, activeClass) {
					var items = document.querySelectorAll(selector);
					for (var i = 0; i < items.length; i++) {
						items[i].classList.remove(activeClass);

						// Run a callback
						if (selector === settings.selectorContent) {
							settings.callbackClose(items[i]);
						}
					}
				};

				// Close all accordions and toggles
				publicAPIs.closeAccordions = function () {
					closeItems(settings.selectorContent, settings.contentClass);
					closeItems(settings.selectorToggle, settings.toggleClass);
				};

				// Run our accordion script
				var runAccordion = function () {
					// Only run if the clicked link was an accordion toggle
					if (!event.target.matches(settings.selectorToggle)) return;

					// Get the target content
					var content = document.querySelector(event.target.hash);
					if (!content) return;

					// Prevent default link behavior
					event.preventDefault();

					// If the content is already expanded, collapse it and quit
					var expanded = isActive(content, event.target);
					if (expanded) return;

					// Close all accordion content and toggles
					publicAPIs.closeAccordions();

					// Open our target content area and toggle link
					content.classList.add(settings.contentClass);
					event.target.classList.add(settings.toggleClass);

					// Run a callback
					// content = the accordion
					// event.target = the toggle
					settings.callbackOpen(content, event.target);
				};

				// Initialize our plugin
				publicAPIs.init = function (options) {
					// Feature test
					var supports = 'querySelector' in document && 'addEventListener' in window;
					if (!supports) return;

					// Merge user options with the defaults
					settings = extend(defaults, options || {});

					// Listen for click events
					document.addEventListener('click', runAccordion, false);

					// Add our initialization class
					document.documentElement.className += ' ' + settings.init;
				};

				// Return our public APIs
				return publicAPIs;

			})();

			accordion.init({
				callbackClose: function (item) {
					console.group('Close');
						console.log(item);
					console.groupEnd();
				},
				callbackOpen: function (content, toggle) {
					console.group('Open');
						console.log(content);
						console.log(toggle);
					console.groupEnd();
				}
			});
		</script>
	</body>
</html>